// SPDX-License-Identifier: UNLICENSED
pragma solidity =0.8.20;

import "forge-std/Test.sol";
import "../src/zkPaymaster.sol";
import "../src/zkPaymasterFactory.sol";
import {IEntryPoint} from "account-abstraction/interfaces/IEntryPoint.sol";

contract ZKPaymasterTest is Test {
    ZKPaymasterFactory public zkPaymasterFactory;
    ZKPaymaster public zkPaymaster;

    function setUp() public {
        zkPaymasterFactory = new ZKPaymasterFactory();
        zkPaymaster = ZKPaymaster(
            zkPaymasterFactory.create(
                0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789,
                msg.sender,
                0x45792cd187672019da6ee08aef36eb46,
                0xe0e48a90f6e0fcbd6dd5c27de151e263
            )
        );
    }

    function testPaymasterExists() public {
        assertFalse(address(zkPaymaster) == address(0));
    }

    function testCompareBytes() public {
        bytes
            memory bytesToCheck = hex"9e5d4c49000000000000000000000000d8134205b0328f5676aaefb3b2a0dc15f4029d8c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000064ba08765200000000000000000000000000000000000000000000000000005af3107a4000000000000000000000000000783a6267e072b72cc63cb7a6efe1b5a8934b5853000000000000000000000000783a6267e072b72cc63cb7a6efe1b5a8934b585300000000000000000000000000000000000000000000000000000000";
        bytes
            memory bytesToCheckIn = hex"D8134205b0328F5676aaeFb3B2a0DC15f4029d8C";
        bool result = zkPaymaster.checkBytesIncluded(
            bytesToCheck,
            bytesToCheckIn
        );
        assertTrue(result);
    }

    function test_validatePaymasterUserOp() public {}

    function testverifySismoConnectResponse() public {
        bytes memory res = hex"000000000000000000000000000000000000000000000000000000000000002045792cd187672019da6ee08aef36eb4600000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76312e31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000014783a6267e072b72cc63cb7a6efe1b5a8934b585300000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012d3183add1af06fb458aa456aee862725ad78998f06d36ed97dac95ab18a978400000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c00082545294047826de5966f777fd38ec5ebac4d82c43f8e72a4ec98784fc4cc62b04952d6915ae4819fbc82bf3810eb391e8998f53397a19992f358d7b155a091979ca71b7de5df10d3278993ed2c966c414d2da619f582e4299daf2d507177a0d5e42cfe8992816a7bb2a38ba5345680a9991a073d1b2b1fc294571fe7c357629d71214c9c460ce02a793bca7d542c5856c8d5d284d0ed153dabc7fa3d2de741c661675e53c82bc56564c3162b223ec96e0fad4ae9138a5b1f5d09905cd8d172b0ad5c84301ffdd62e8420923bb70bcc93338bcfc828859bd3853a6a64e67232f4f25f406ea2cb4dc8e7dc9008d8f2917201d9ef40adb845f651d4aeef314b100000000000000000000000000000000000000000000000000000000000000001e0d3ede787ef80beaa7aaa3d512236cc72a22ef1c031796847bcd2385286efe07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002d3183add1af06fb458aa456aee862725ad78998f06d36ed97dac95ab18a97840adf8a35a332d2a346ea3f188be37567866705f1af2179b1f18d8af2dad93cb700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000e0e48a90f6e0fcbd6dd5c27de151e263000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c012f00014d9470c4d1fe250705c992e3de7b0a27240a8aba3d90ec9f52170164a09b74a553af45ff0f00f9c0a3ef5e7460f463c1719959433200230bcb720fb7b2fe34e087c13436c0765515634e129b6bfc23b591e0d588ad1ddd5689091f0130f2a9548be15328683445c6b0ae11625c71134f7c37d70b1ede101b779d1c7b626ac6db4fb1e3f48787c685686f9b8cec1b9a2226d14f460405588d76cd1d0722dc4fae6bd90d163888e7a1729ea0054fec0bb77e7162118b1804020d5069200040510a8f83968fb279c4be739cdccb7fac8e29ffaf8932d0f1e7d58c584e4000adc39f36fd5b89e12af978a6ed9154458d5e62421095a9ea288a1ed6e3ce2ed00000000000000000000000000000000000000000000000000000000000000001e0d3ede787ef80beaa7aaa3d512236cc72a22ef1c031796847bcd2385286efe07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa1b6d4bf416ee6fd12eb7f37ae3015421ea20150a74b4e782bc6a8e30e179bcc42b0d381d62d68d00a458109cddda733b63dabf01e6828903052ea160924171c8241f50be23011eb999c30aa646de37e59bb18bb0d671e016d8b571f27218c6eb00000000000000000000000000000000000000000000000000000000000000011f5350c5721a7c168c94aba3db4c80eecb91d3438c8e3dbaf07829b03ffffffc00000000000000000000000000000000000000000000000000000000000000002d3183add1af06fb458aa456aee862725ad78998f06d36ed97dac95ab18a97840adf8a35a332d2a346ea3f188be37567866705f1af2179b1f18d8af2dad93cb7000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        // bytes memory res = bytes(
        //     "000000000000000000000000000000000000000000000000000000000000002045792cd187672019da6ee08aef36eb4600000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76312e31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000014783a6267e072b72cc63cb7a6efe1b5a8934b585300000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012d3183add1af06fb458aa456aee862725ad78998f06d36ed97dac95ab18a978400000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c00082545294047826de5966f777fd38ec5ebac4d82c43f8e72a4ec98784fc4cc62b04952d6915ae4819fbc82bf3810eb391e8998f53397a19992f358d7b155a091979ca71b7de5df10d3278993ed2c966c414d2da619f582e4299daf2d507177a0d5e42cfe8992816a7bb2a38ba5345680a9991a073d1b2b1fc294571fe7c357629d71214c9c460ce02a793bca7d542c5856c8d5d284d0ed153dabc7fa3d2de741c661675e53c82bc56564c3162b223ec96e0fad4ae9138a5b1f5d09905cd8d172b0ad5c84301ffdd62e8420923bb70bcc93338bcfc828859bd3853a6a64e67232f4f25f406ea2cb4dc8e7dc9008d8f2917201d9ef40adb845f651d4aeef314b100000000000000000000000000000000000000000000000000000000000000001e0d3ede787ef80beaa7aaa3d512236cc72a22ef1c031796847bcd2385286efe07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002d3183add1af06fb458aa456aee862725ad78998f06d36ed97dac95ab18a97840adf8a35a332d2a346ea3f188be37567866705f1af2179b1f18d8af2dad93cb700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000e0e48a90f6e0fcbd6dd5c27de151e263000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c012f00014d9470c4d1fe250705c992e3de7b0a27240a8aba3d90ec9f52170164a09b74a553af45ff0f00f9c0a3ef5e7460f463c1719959433200230bcb720fb7b2fe34e087c13436c0765515634e129b6bfc23b591e0d588ad1ddd5689091f0130f2a9548be15328683445c6b0ae11625c71134f7c37d70b1ede101b779d1c7b626ac6db4fb1e3f48787c685686f9b8cec1b9a2226d14f460405588d76cd1d0722dc4fae6bd90d163888e7a1729ea0054fec0bb77e7162118b1804020d5069200040510a8f83968fb279c4be739cdccb7fac8e29ffaf8932d0f1e7d58c584e4000adc39f36fd5b89e12af978a6ed9154458d5e62421095a9ea288a1ed6e3ce2ed00000000000000000000000000000000000000000000000000000000000000001e0d3ede787ef80beaa7aaa3d512236cc72a22ef1c031796847bcd2385286efe07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa1b6d4bf416ee6fd12eb7f37ae3015421ea20150a74b4e782bc6a8e30e179bcc42b0d381d62d68d00a458109cddda733b63dabf01e6828903052ea160924171c8241f50be23011eb999c30aa646de37e59bb18bb0d671e016d8b571f27218c6eb00000000000000000000000000000000000000000000000000000000000000011f5350c5721a7c168c94aba3db4c80eecb91d3438c8e3dbaf07829b03ffffffc00000000000000000000000000000000000000000000000000000000000000002d3183add1af06fb458aa456aee862725ad78998f06d36ed97dac95ab18a97840adf8a35a332d2a346ea3f188be37567866705f1af2179b1f18d8af2dad93cb7000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
        // );

        address _userOpSender = address(
            0x783A6267e072b72cc63cb7a6EFe1b5a8934B5853
        );

        bool result = zkPaymaster.verifySismoConnectResponse(
            res,
            _userOpSender
        );
    }
}
